<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Offline Multi-Window PWA</title>

  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0d1117" />
  <style>
    :root{
      --bg:#0d1117; --card:#161b22; --accent:#4ae3f7; --muted:#9aa6b2; --glass: rgba(255,255,255,0.03);
      --radius:12px; --pad:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, Arial, sans-serif; background:var(--bg); color:#e6edf3;
      display:flex; align-items:flex-start; justify-content:center; padding:20px;
    }
    .app{
      width:100%; max-width:980px; display:grid; grid-template-columns:260px 1fr; gap:20px;
    }
    nav{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:var(--radius); padding:12px; height:calc(100vh - 40px); position:sticky; top:20px;
      box-shadow:0 6px 20px rgba(0,0,0,0.6);
    }
    .logo{font-weight:700; color:var(--accent); font-size:18px; margin:6px 0 14px}
    .navlink{display:block; padding:10px 12px; border-radius:8px; color:var(--muted); text-decoration:none; margin-bottom:8px}
    .navlink.active{background:var(--glass); color:#e6edf3}
    main{
      min-height:calc(100vh - 40px);
      background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      border-radius:var(--radius); padding:20px;
      box-shadow:0 6px 20px rgba(0,0,0,0.6);
    }
    header.app-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:16px}
    .badge{padding:6px 10px; background:rgba(255,255,255,0.03); border-radius:10px; color:var(--muted); font-size:13px}
    .view{display:none}
    .view.active{display:block}
    /* small cards */
    .card{background:var(--card); padding:16px; border-radius:12px; margin-bottom:12px}
    button{background:var(--accent); border:none; color:#011; padding:8px 12px; border-radius:8px; cursor:pointer}
    input, textarea{width:100%; padding:10px; margin-top:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit}
    .row{display:flex; gap:12px}
    .note{padding:10px; background:rgba(255,255,255,0.02); border-radius:8px; margin-bottom:8px}
    .calc-display{font-size:20px; padding:12px; background:rgba(255,255,255,0.02); border-radius:8px; margin-bottom:8px}
    .gallery-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(120px,1fr)); gap:12px}
    .thumb{background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; padding:8px; text-align:center}
    .small-muted{color:var(--muted); font-size:13px}
    footer{margin-top:18px; color:var(--muted); font-size:13px}
    .status{font-weight:600; color:var(--muted)}
    @media(max-width:840px){
      .app{grid-template-columns:1fr; padding-bottom:40px}
      nav{height:auto; position:relative}
      main{min-height:0}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <nav>
      <div class="logo">Offline Multi-Window</div>

      <a class="navlink" href="#home" data-view="home">üè† Home</a>
      <a class="navlink" href="#notes" data-view="notes">üóí Notes</a>
      <a class="navlink" href="#calc"  data-view="calc">üßÆ Calculator</a>
      <a class="navlink" href="#gallery" data-view="gallery">üñº Gallery</a>
      <a class="navlink" href="#settings" data-view="settings">‚öôÔ∏è Settings</a>

      <div style="margin-top:18px">
        <div class="small-muted">Connection:</div>
        <div id="conn" class="badge">Checking‚Ä¶</div>
      </div>

      <div style="margin-top:14px">
        <button id="open-new">Open new window</button>
      </div>

      <footer>
        <div style="margin-top:14px">Version 1.0 ‚Ä¢ PWA</div>
      </footer>
    </nav>

    <main>
      <header class="app-header">
        <div>
          <h2 id="page-title">Home</h2>
          <div class="small-muted" id="page-sub">Multiple windows (views) cached for offline use</div>
        </div>
        <div>
          <span class="badge" id="install-prompt">Install</span>
        </div>
      </header>

      <!-- HOME -->
      <section id="home" class="view active">
        <div class="card">
          <h3>Welcome</h3>
          <p class="small-muted">This single HTML file implements many "windows" (views). It is cache-friendly and will work offline after installation.</p>
          <p>Try switching views, then go offline ‚Äî everything you need is cached.</p>
          <div style="margin-top:10px">
            <button onclick="alert('Still works offline!')">Test Button</button>
            <button onclick="window.location.hash='notes'">Go to Notes</button>
          </div>
        </div>

        <div class="card">
          <h4>Quick actions</h4>
          <div class="row" style="margin-top:8px">
            <button onclick="openInNewWindow('#notes')">Notes in new window</button>
            <button onclick="openInNewWindow('#gallery')">Gallery in new window</button>
          </div>
        </div>
      </section>

      <!-- NOTES -->
      <section id="notes" class="view">
        <div class="card">
          <h3>Notes</h3>
          <p class="small-muted">Saved locally (localStorage) ‚Äî available offline.</p>

          <input id="note-title" placeholder="Title" />
          <textarea id="note-body" rows="4" placeholder="Your note here..."></textarea>
          <div style="margin-top:8px">
            <button id="save-note">Save Note</button>
            <button id="clear-notes" style="background:#ff7aa2">Clear All</button>
          </div>
        </div>

        <div class="card">
          <h4>Saved notes</h4>
          <div id="notes-list"></div>
        </div>
      </section>

      <!-- CALC -->
      <section id="calc" class="view">
        <div class="card">
          <h3>Calculator</h3>
          <div class="calc-display" id="calc-display">0</div>
          <div class="row" style="flex-wrap:wrap">
            <button onclick="calcPush('7')">7</button>
            <button onclick="calcPush('8')">8</button>
            <button onclick="calcPush('9')">9</button>
            <button onclick="calcOp('/')">√∑</button>

            <button onclick="calcPush('4')">4</button>
            <button onclick="calcPush('5')">5</button>
            <button onclick="calcPush('6')">6</button>
            <button onclick="calcOp('*')">√ó</button>

            <button onclick="calcPush('1')">1</button>
            <button onclick="calcPush('2')">2</button>
            <button onclick="calcPush('3')">3</button>
            <button onclick="calcOp('-')">‚àí</button>

            <button onclick="calcPush('0')">0</button>
            <button onclick="calcPush('.')">.</button>
            <button onclick="calcEquals()">=</button>
            <button onclick="calcOp('+')">+</button>

            <button onclick="calcClear()" style="flex:1; margin-top:8px; background:#ff8b4b">Clear</button>
          </div>
        </div>
      </section>

      <!-- GALLERY -->
      <section id="gallery" class="view">
        <div class="card">
          <h3>Gallery</h3>
          <p class="small-muted">Built-in images (SVG) so nothing external is needed.</p>
          <div class="gallery-grid" id="gallery-grid">
            <!-- JS populates thumbnails -->
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="view">
        <div class="card">
          <h3>Settings</h3>
          <label class="small-muted">Theme (demo)</label>
          <div style="margin-top:8px">
            <button onclick="changeTheme('#0d1117')">Dark</button>
            <button onclick="changeTheme('#ffffff')">Light</button>
          </div>
        </div>

        <div class="card">
          <h4>Cache info</h4>
          <div id="cache-info" class="small-muted">Checking cache‚Ä¶</div>
        </div>
      </section>

      <footer style="margin-top:16px" id="footer"></footer>
    </main>
  </div>

  <script>
    // ---- Basic router (hash-based) ----
    const views = document.querySelectorAll('.view');
    const navLinks = document.querySelectorAll('.navlink');
    function showView(name){
      // update title
      document.querySelector('#page-title').textContent = name[0].toUpperCase() + name.slice(1);
      document.querySelector('#page-sub').textContent = (name === 'home') ? 'Multiple windows cached' : '';
      views.forEach(v => v.classList.toggle('active', v.id === name));
      navLinks.forEach(a => a.classList.toggle('active', a.dataset.view === name));
    }
    function handleHash(){
      const h = location.hash.replace('#','') || 'home';
      showView(h);
    }
    window.addEventListener('hashchange', handleHash);
    handleHash();

    // ---- connection indicator ----
    const conn = document.getElementById('conn');
    function updateConnection(){
      conn.textContent = navigator.onLine ? 'Online' : 'Offline';
      conn.style.color = navigator.onLine ? '#9ee6b8' : '#ff9090';
    }
    window.addEventListener('online', updateConnection);
    window.addEventListener('offline', updateConnection);
    updateConnection();

    // ---- NOTES (localStorage) ----
    const notesKey = 'offline-fw-notes:v1';
    function loadNotes(){
      const list = document.getElementById('notes-list'); list.innerHTML='';
      const store = JSON.parse(localStorage.getItem(notesKey) || '[]');
      if(!store.length) list.innerHTML = '<div class="small-muted">No notes yet</div>';
      store.forEach((n, i) => {
        const el = document.createElement('div'); el.className='note';
        el.innerHTML = `<strong>${escapeHtml(n.title || 'Untitled')}</strong><div style="margin-top:6px">${escapeHtml(n.body||'')}</div>
          <div style="margin-top:8px"><button onclick="deleteNote(${i})">Delete</button></div>`;
        list.appendChild(el);
      });
    }
    function saveNote(){
      const t = document.getElementById('note-title').value;
      const b = document.getElementById('note-body').value;
      const store = JSON.parse(localStorage.getItem(notesKey) || '[]');
      store.unshift({title:t, body:b, created:Date.now()});
      localStorage.setItem(notesKey, JSON.stringify(store));
      document.getElementById('note-title').value=''; document.getElementById('note-body').value='';
      loadNotes();
    }
    function deleteNote(idx){
      const store = JSON.parse(localStorage.getItem(notesKey) || '[]');
      store.splice(idx,1);
      localStorage.setItem(notesKey, JSON.stringify(store));
      loadNotes();
    }
    function clearNotes(){
      if(!confirm('Clear all notes?')) return;
      localStorage.removeItem(notesKey); loadNotes();
    }
    document.getElementById('save-note').addEventListener('click', saveNote);
    document.getElementById('clear-notes').addEventListener('click', clearNotes);
    loadNotes();

    // ---- Calculator ----
    let calcState = '';
    function calcPush(v){ calcState += v; renderCalc(); }
    function calcOp(op){ calcState += ' ' + op + ' '; renderCalc(); }
    function calcEquals(){ try{ const r = Function('"use strict";return ('+calcState+')')(); calcState = String(r); }catch(e){ calcState='Error' } renderCalc(); }
    function calcClear(){ calcState=''; renderCalc(); }
    function renderCalc(){ document.getElementById('calc-display').textContent = calcState || '0'; }

    // ---- Gallery (inline SVGs) ----
    const galleryGrid = document.getElementById('gallery-grid');
    const svgs = [
      {title:'Mountains', svg:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 80"><rect width="100%" height="100%" fill="#0b1220"/><g fill="#4ae3f7"><path d="M10 70 L40 20 L70 70 Z"/></g></svg>`},
      {title:'Sunset', svg:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 80"><rect width="100%" height="100%" fill="#0b1220"/><circle cx="60" cy="40" r="18" fill="#ffb86b"/></svg>`},
      {title:'Wave', svg:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 80"><rect width="100%" height="100%" fill="#0b1220"/><path d="M0 60 Q30 30 60 60 T120 60 V80 H0 Z" fill="#7bdff6"/></svg>`},
      {title:'Abstract', svg:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 80"><rect width="100%" height="100%" fill="#0b1220"/><circle cx="30" cy="30" r="12" fill="#d16aff"/><rect x="60" y="20" width="40" height="30" rx="6" fill="#4ae3f7"/></svg>`}
    ];
    function populateGallery(){
      galleryGrid.innerHTML = '';
      svgs.forEach(s=>{
        const d = document.createElement('div'); d.className='thumb';
        d.innerHTML = `${s.svg}<div style="margin-top:8px">${s.title}</div>`;
        galleryGrid.appendChild(d);
      });
    }
    populateGallery();

    // ---- Settings theme demo ----
    function changeTheme(bg){
      document.documentElement.style.setProperty('--bg', bg);
      // adjust text color for light theme
      if(bg === '#ffffff'){ document.body.style.color = '#111'; document.querySelectorAll('.card').forEach(c=>c.style.background='white'); }
      else { document.body.style.color = '#e6edf3'; document.querySelectorAll('.card').forEach(c=>c.style.background='var(--card)'); }
    }

    // ---- Open new window (or tab) ----
    function openInNewWindow(hash){
      // opens a new browser window/tab pointing to same origin + hash
      window.open(location.origin + location.pathname + hash, '_blank');
    }
    document.getElementById('open-new').addEventListener('click', ()=> openInNewWindow('#notes'));

    // ---- install prompt handling (simplified) ----
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('install-prompt').textContent = 'Install';
      document.getElementById('install-prompt').style.cursor = 'pointer';
      document.getElementById('install-prompt').onclick = async () => {
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        deferredPrompt = null;
        document.getElementById('install-prompt').textContent = choiceResult.outcome === 'accepted' ? 'Installed' : 'Install';
      };
    });

    // ---- cache info (reads from caches) ----
    async function showCacheInfo(){
      if(!('caches' in window)){ document.getElementById('cache-info').textContent='No caches API'; return; }
      const names = await caches.keys();
      document.getElementById('cache-info').textContent = names.length ? 'Caches: ' + names.join(', ') : 'No caches yet';
    }
    showCacheInfo();

    // ---- utility ----
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])); }

    // expose to console for debugging
    window.openInNewWindow = openInNewWindow;
    window.calcPush = calcPush;
    window.calcOp = calcOp;
    window.calcEquals = calcEquals;
    window.calcClear = calcClear;
    window.deleteNote = deleteNote;

  </script>

  <script>
    // register service worker (external file)
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/sw.js').then(reg => console.log('SW registered', reg)).catch(err => console.warn('SW failed', err));
    }
  </script>
</body>
</html>